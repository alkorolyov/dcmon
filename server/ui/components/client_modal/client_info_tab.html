<!-- Hardware Information Section -->
{% if hardware_info %}
<div class="hardware-section">
    <h4>Hardware Information</h4>
    
    <!-- Main Components Row (Motherboard, CPU, GPU, RAM) -->
    {% set has_main_components = (hardware_info.motherboard != "Unknown" or hardware_info.cpu != "Unknown" or hardware_info.gpu != "Unknown" or hardware_info.ram_gb > 0) %}
    {% if has_main_components %}
    <div class="hardware-row">
        {% if hardware_info.motherboard != "Unknown" %}
        <div class="hardware-item">
            <span class="hardware-label">MDB</span>
            <span class="hardware-value">{{ hardware_info.motherboard }}</span>
        </div>
        {% endif %}
        {% if hardware_info.cpu != "Unknown" %}
        <div class="hardware-item">
            <span class="hardware-label">CPU</span>
            <span class="hardware-value">{{ hardware_info.cpu }}</span>
        </div>
        {% endif %}
        {% if hardware_info.gpu != "Unknown" %}
        <div class="hardware-item">
            <span class="hardware-label">GPU</span>
            <span class="hardware-value">{% if hardware_info.gpu_count > 1 %}{{ hardware_info.gpu_count }} x {% endif %}{{ hardware_info.gpu }}</span>
        </div>
        {% endif %}
        {% if hardware_info.ram_gb > 0 %}
        <div class="hardware-item">
            <span class="hardware-label">RAM</span>
            <span class="hardware-value">{{ hardware_info.ram_gb }} GB</span>
        </div>
        {% endif %}
    </div>
    {% endif %}
    
    <!-- Drives - Each Drive as Separate Cell in One Row -->
    {% if hardware_info.drives %}
    <div class="hardware-row">
        {% for drive in hardware_info.drives %}
        <div class="hardware-item">
            <span class="hardware-label">Drive {{ loop.index }}</span>
            <span class="hardware-value">{{ drive.model or drive.device }} ({{ (drive.size_gb or 0)|round(1) }}GB)</span>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    <!-- Vast.ai Information Row -->
    {% if hardware_info.vast_machine_id or hardware_info.vast_port_range %}
    <div class="hardware-row">
        {% if hardware_info.vast_machine_id %}
        <div class="hardware-item vast-machine-id">
            <span class="hardware-label">Machine ID</span>
            <span class="hardware-value">{{ hardware_info.vast_machine_id }}</span>
        </div>
        {% endif %}
        {% if hardware_info.vast_port_range %}
        <div class="hardware-item vast-port-range">
            <span class="hardware-label">Port Range</span>
            <span class="hardware-value">{{ hardware_info.vast_port_range }}</span>
        </div>
        {% endif %}
    </div>
    {% endif %}
    
</div>
{% endif %}

<!-- Device Metrics - Balanced Column Layout -->
<div class="device-metrics-card">
    <div class="metrics-grid">
        
        {% set all_metrics = [] %}
        
        <!-- GPUs -->
        {% if detailed_metrics.gpu_table %}
        {% set _ = all_metrics.append('HEADER:GPUs') %}
        {% for gpu in detailed_metrics.gpu_table %}
        {% if gpu.Temperature %}
        {% set _ = all_metrics.append(gpu.device + ' Temp: ' + gpu.Temperature.formatted) %}
        {% endif %}
        {% if gpu.Utilization %}
        {% set _ = all_metrics.append(gpu.device + ' Util: ' + gpu.Utilization.formatted) %}
        {% endif %}
        {% if gpu['Power Draw'] %}
        {% set _ = all_metrics.append(gpu.device + ' Power: ' + gpu['Power Draw'].formatted) %}
        {% endif %}
        {% endfor %}
        {% set _ = all_metrics.append('') %}
        {% endif %}
        
        <!-- PSU -->
        {% if detailed_metrics.psu_table %}
        {% set _ = all_metrics.append('HEADER:Power Supply') %}
        {% for psu in detailed_metrics.psu_table %}
        {% if psu['Power Input'] %}
        {% set _ = all_metrics.append(psu.device + ' Input: ' + psu['Power Input'].formatted) %}
        {% endif %}
        {% if psu['Fan Speed'] %}
        {% set _ = all_metrics.append(psu.device + ' Fan: ' + psu['Fan Speed'].formatted) %}
        {% endif %}
        {% if psu.Temperature %}
        {% set _ = all_metrics.append(psu.device + ' Temp: ' + psu.Temperature.formatted) %}
        {% endif %}
        {% endfor %}
        {% set _ = all_metrics.append('') %}
        {% endif %}
        
        <!-- Storage -->
        {% if detailed_metrics.storage_table %}
        {% set _ = all_metrics.append('HEADER:Storage') %}
        {% for storage in detailed_metrics.storage_table %}
        {% if storage['Used Space'] %}
        {% set _ = all_metrics.append(storage.device + ' Used: ' + storage['Used Space'].formatted) %}
        {% endif %}
        {% if storage['Free Space'] %}
        {% set _ = all_metrics.append(storage.device + ' Free: ' + storage['Free Space'].formatted) %}
        {% endif %}
        {% if storage['Wear Level'] %}
        {% set _ = all_metrics.append(storage.device + ' Wear: ' + storage['Wear Level'].formatted) %}
        {% endif %}
        {% if storage.Temperature %}
        {% set _ = all_metrics.append(storage.device + ' Temp: ' + storage.Temperature.formatted) %}
        {% endif %}
        {% endfor %}
        {% set _ = all_metrics.append('') %}
        {% endif %}
        
        <!-- Network -->
        {% if detailed_metrics.network %}
        {% set _ = all_metrics.append('HEADER:Network') %}
        {% for interface_id, interface_metrics in detailed_metrics.network.items() %}
        {% for metric_type, metric_data in interface_metrics.items() %}
        {% set _ = all_metrics.append(interface_id + ' ' + metric_type + ': ' + metric_data.formatted) %}
        {% endfor %}
        {% endfor %}
        {% set _ = all_metrics.append('') %}
        {% endif %}
        
        <!-- System Sensors organized by type -->
        {% if detailed_metrics.system %}
        {% set temp_sensors = [] %}
        {% set fan_sensors = [] %}
        {% set voltage_sensors = [] %}
        {% set other_sensors = [] %}
        
        {% for sensor_name, metric_data in detailed_metrics.system.items() %}
        {% set clean_name = sensor_name.split(' (')[0] %}
        {% set metric_line = clean_name + ': ' + metric_data.formatted %}
        
        {% if 'temp' in metric_data.metric_name.lower() or 'temp' in clean_name.lower() %}
        {% set _ = temp_sensors.append(metric_line) %}
        {% elif 'fan' in metric_data.metric_name.lower() or 'fan' in clean_name.lower() or 'rpm' in metric_data.formatted %}
        {% set _ = fan_sensors.append(metric_line) %}
        {% elif 'v' in metric_data.formatted or 'volt' in metric_data.metric_name.lower() %}
        {% set _ = voltage_sensors.append(metric_line) %}
        {% else %}
        {% set _ = other_sensors.append(metric_line) %}
        {% endif %}
        {% endfor %}
        
        <!-- Temperatures -->
        {% if temp_sensors %}
        {% set _ = all_metrics.append('HEADER:Temperatures') %}
        {% for sensor in temp_sensors %}
        {% set _ = all_metrics.append(sensor) %}
        {% endfor %}
        {% set _ = all_metrics.append('') %}
        {% endif %}
        
        <!-- Fans -->
        {% if fan_sensors %}
        {% set _ = all_metrics.append('HEADER:Fans') %}
        {% for sensor in fan_sensors %}
        {% set _ = all_metrics.append(sensor) %}
        {% endfor %}
        {% set _ = all_metrics.append('') %}
        {% endif %}
        
        <!-- Voltages -->
        {% if voltage_sensors %}
        {% set _ = all_metrics.append('HEADER:Voltages') %}
        {% for sensor in voltage_sensors %}
        {% set _ = all_metrics.append(sensor) %}
        {% endfor %}
        {% set _ = all_metrics.append('') %}
        {% endif %}
        
        <!-- Other System -->
        {% if other_sensors %}
        {% set _ = all_metrics.append('HEADER:System Status') %}
        {% for sensor in other_sensors %}
        {% set _ = all_metrics.append(sensor) %}
        {% endfor %}
        {% endif %}
        {% endif %}
        
        <!-- Distribute across 5 columns -->
        {% set metrics_per_col = (all_metrics|length / 5)|round(0, 'ceil')|int %}
        
        {% for col in range(5) %}
        <div class="metric-col">
            {% set start = col * metrics_per_col %}
            {% set end = start + metrics_per_col %}
            {% for metric in all_metrics[start:end] %}
            {% if metric == '' %}
            <div class="metric-separator"></div>
            {% elif metric.startswith('HEADER:') %}
            <div class="group-header">{{ metric[7:] }}</div>
            {% else %}
            <div class="metric-row">{{ metric }}</div>
            {% endif %}
            {% endfor %}
        </div>
        {% endfor %}
        
    </div>
</div>